#!/usr/bin/env ruby
require 'thor'
$:.push File.join(File.expand_path(File.dirname(__FILE__)), '..', 'lib')
require 'scrunch'

class ScrunchCommand < Thor
  desc "crunch -f FILENAME", "crunch a log file"
  method_options %w(file -f) => :string, required: true
  def crunch
    if options[:file].nil? #TODO use stderr
      puts 'Use -f to pass a file, eg: scrunch -f path/to/combatlog.txt'
      return
    end

    cruncher = Scrunch::Cruncher.new options[:file]
    cruncher.crunch

    # Thor acts as the controller/view layer for the CLI
    rows = cruncher.ordered_sources.collect { |x| x[1] = {value: x[1], alignment: :right}; x }
    puts Terminal::Table.new(rows: rows)
  end

  default_task :crunch
end

ScrunchCommand.start
